---
import type { CurrencyRate } from '../ts/API/useRates';

export interface Props {
  rates: CurrencyRate[];
  lastUpdate: string;
}

const { rates, lastUpdate } = Astro.props;
---

<section class="rates">
  <div class="rates__container">
    <div class="rates__card">
      <div class="rates__top js-from-down">
        <h1 class="rates__title rw-48-600"><span>GENES</span>EXCHANGE</h1>
        <div class="rates__top-content">
          <p class="rates__time rw-16-400">
            Poslednji put ažurirano: <span id="last-update">{lastUpdate || 'Error'}</span>
          </p>
          <p class="rates__description rw-16-400">
            Kursevi su informativnog karaktera i podložni su promenama.
          </p>
        </div>
      </div>

      <div class="rates__columns">
        <div class="rates__columns-left">
          <!-- Rates table -->
          <table class="rates__table">
            <thead>
              <tr>
                <th class="rw-16-700">Valuta</th>
                <th class="rw-16-700">Kupovni</th>
                <th class="rw-16-700">Prodajni</th>
              </tr>
            </thead>
            <tbody>
              {
                rates.map((rate) => (
                  <tr
                    class="rates__table-row"
                    data-currency={rate.currency}
                    data-buy-rate={rate.buyRate}
                    data-sell-rate={rate.sellRate}
                    data-currency-image={rate.currencyImage}
                  >
                    <td class="rw-16-400 rates__table-currency">
                      {rate.currencyImage && (
                        <img
                          src={rate.currencyImage}
                          alt={rate.currency}
                          class="rates__table-flag"
                          onerror="this.style.display='none'"
                        />
                      )}
                      <span>{rate.currency}</span>
                    </td>
                    <td class="rw-16-400">{rate.buyRate.toFixed(2)}</td>
                    <td class="rw-16-400">{rate.sellRate.toFixed(2)}</td>
                    <td class="rates__table-more">
                      <span>⋮</span>
                    </td>
                  </tr>
                ))
              }
            </tbody>
          </table>
        </div>

        <div class="rates__columns-right">
          <button class="rates__back-btn rw-20-600" id="back-btn" aria-label="Back" style="display: none;" data-svg="arrow-right">
            Vrati se nazad
          </button>

          <!-- Chart column -->
          <div class="rates__right-content">
            <div class="rates__chart-header">
              <img
                id="selected-flag"
                src=""
                alt=""
                class="rates__table-flag"
                style="width: 40px; height: 30px; display: none;"
                onerror="this.style.display='none'"
              />
              <h2 class="rw-24-600" style="display: flex; align-items: center; gap: 10px">
                <span id="selected-currency"></span> - <span id="selected-type-label">Kupovni</span>
              </h2>
            </div>
            <div class="rates__interval-buttons">
              <button class="rates__interval-button rates__interval-button--active" data-type="buy">
                BUY
              </button>
              <button class="rates__interval-button" data-type="sell"> SELL </button>
            </div>
            <div class="rates__chart-loading" id="chart-loading" style="display: none;">
              <div class="loader"></div>
            </div>
            <canvas id="rates-chart" class="rates__chart"></canvas>
            <div class="rates__interval-buttons">
              <button
                class="rates__interval-button rates__interval-button--active"
                data-interval="day"
              >
                Day
              </button>
              <button class="rates__interval-button" data-interval="week"> Week </button>
              <button class="rates__interval-button" data-interval="month"> Month </button>
              <button class="rates__interval-button" data-interval="year"> Year </button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>
