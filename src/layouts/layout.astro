---
import Header from '../components/header.astro';
import Footer from '../components/footer.astro';

export interface Props {
  title: string;
  description?: string;
  lang?: 'sr' | 'en';
  canonicalURL?: string;
  ogImage?: string;
  isErrorPage?: boolean;
}

const { title, description, lang = 'sr', canonicalURL, ogImage, isErrorPage = false } = Astro.props;

const finalDescription =
  description ||
  (lang === 'en'
    ? 'Genes Exchange Office – Your reliable partner for currency exchange, bill payments, insurance, and financial services. For more than 10 years, we’ve been providing secure, fast, and simple financial solutions.'
    : 'Menjačnica Genes – Vaš pouzdan partner za razmenu valuta, uplatu računa, osiguranja, komunalija. Sigurno, brzo i jednostavno. Već više od 10 godina sa vama.');

const baseURL = 'https://menjacnicagenes.rs';
const currentCanonicalURL = canonicalURL || new URL(Astro.url.pathname, baseURL).href;

const currentPath = Astro.url.pathname;
const srURL = currentPath.startsWith('/en/')
  ? new URL(currentPath.replace('/en/', '/'), baseURL).href
  : new URL(currentPath, baseURL).href;

const hasEnglishVersion =
  currentPath === '/' || currentPath === '/kursna-lista' || currentPath.startsWith('/en/');
const enURL = currentPath.startsWith('/en/')
  ? new URL(currentPath, baseURL).href
  : hasEnglishVersion && currentPath === '/'
    ? new URL('/en/', baseURL).href
    : hasEnglishVersion && currentPath === '/kursna-lista'
      ? new URL('/en/exchange-rates', baseURL).href
      : null;

// Open Graph Image
const defaultOgImage = `${baseURL}/images/GenesLogoMeta.webp`;
const ogImageURL = ogImage ? `${baseURL}${ogImage}` : defaultOgImage;

// Structured Data
const descriptions = {
  sr: 'Menjačnica Genes – Vaš pouzdan partner za razmenu valuta, uplatu računa, osiguranja, komunalija. Sigurno, brzo i jednostavno. Već više od 10 godina sa vama.',
  en: 'Genes Exchange Office – Your reliable partner for currency exchange, bill payments, insurance, and financial services. For more than 10 years, we’ve been providing secure, fast, and simple financial solutions.',
};

// SEO Keywords
const keywords = {
  sr: 'menjačnica, menjacnica genes, genes exchange, menjačnica novi sad, kursna lista, kurs evra, kurs dolara, zamena valute, razmena valute, devizna menjačnica, otkup valute, prodaja valute, eur rsd, usd rsd, chf rsd, gbp rsd, povoljni kursevi, najpovoljnija menjačnica, platni promet, payspot, uplata računa, menjačnica srbija, exchange office novi sad, novosadski sajam, sajam, sajmiste, komunalije',
  en: 'exchange office, currency exchange, genes exchange, novi sad, exchange rates, euro rate, dollar rate, currency conversion, buy currency, sell currency, eur rsd, usd rsd, chf rsd, gbp rsd, favorable rates, payment transfer, payspot, bill payment, serbia, novosadski sajam, exchange',
};

const searchUrlTemplate =
  lang === 'en'
    ? `${baseURL}/en/exchange-rates?q={search_term_string}`
    : `${baseURL}/kursna-lista?q={search_term_string}`;

const organizationSchema = {
  '@context': 'https://schema.org',
  '@type': 'FinancialService',
  '@id': `${baseURL}/#organization`,
  name: lang === 'sr' ? 'Menjačnica Genes' : 'Genes Exchange',
  alternateName: 'Genes Exchange Office',
  url: baseURL,
  logo: `${baseURL}/images/GenesLogo-white.webp`,
  image: `${baseURL}/images/GenesLogoMeta.webp`,
  description: descriptions[lang],
  inLanguage: lang,
  address: {
    '@type': 'PostalAddress',
    streetAddress: 'Hajduk Veljkova 11',
    addressLocality: 'Novi Sad',
    postalCode: '21000',
    addressCountry: 'RS',
  },
  geo: {
    '@type': 'GeoCoordinates',
    latitude: 45.258443638398376,
    longitude: 19.82320808465672,
  },
  openingHoursSpecification: [
    {
      '@type': 'OpeningHoursSpecification',
      dayOfWeek: ['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday'],
      opens: '08:30',
      closes: '17:00',
    },
    {
      '@type': 'OpeningHoursSpecification',
      dayOfWeek: 'Saturday',
      opens: '08:30',
      closes: '14:00',
    },
  ],
  priceRange: '$$',
  currenciesAccepted: 'EUR, USD, CHF, AUD, CAD, GBP, BAM, RSD',
  paymentAccepted: 'Cash',
  areaServed: {
    '@type': 'City',
    name: 'Novi Sad',
  },
};

const websiteSchema = {
  '@context': 'https://schema.org',
  '@type': 'WebSite',
  '@id': `${baseURL}/#website`,
  name: lang === 'sr' ? 'Menjačnica Genes' : 'Genes Exchange',
  url: baseURL,
  description: descriptions[lang],
  inLanguage: lang,
  potentialAction: {
    '@type': 'SearchAction',
    target: {
      '@type': 'EntryPoint',
      urlTemplate: searchUrlTemplate,
    },
    'query-input': 'required name=search_term_string',
  },
};
---

<!doctype html>
<html lang={lang}>
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <meta name="description" content={finalDescription} />
    <meta name="keywords" content={keywords[lang]} />
    <meta name="generator" content={Astro.generator} />
    <meta
      name="robots"
      content="index, follow, max-image-preview:large, max-snippet:-1, max-video-preview:-1"
    />
    <meta name="googlebot" content="index, follow" />
    <meta name="bingbot" content="index, follow" />

    <!-- Resource hints -->
    <link rel="dns-prefetch" href="https://www.googletagmanager.com" />
    <link rel="preconnect" href="https://www.googletagmanager.com" crossorigin />

    <!-- Favicons -->
    <link rel="apple-touch-icon" sizes="57x57" href="/favicons/apple-icon-57x57.png" />
    <link rel="apple-touch-icon" sizes="60x60" href="/favicons/apple-icon-60x60.png" />
    <link rel="apple-touch-icon" sizes="72x72" href="/favicons/apple-icon-72x72.png" />
    <link rel="apple-touch-icon" sizes="76x76" href="/favicons/apple-icon-76x76.png" />
    <link rel="apple-touch-icon" sizes="114x114" href="/favicons/apple-icon-114x114.png" />
    <link rel="apple-touch-icon" sizes="120x120" href="/favicons/apple-icon-120x120.png" />
    <link rel="apple-touch-icon" sizes="144x144" href="/favicons/apple-icon-144x144.png" />
    <link rel="apple-touch-icon" sizes="152x152" href="/favicons/apple-icon-152x152.png" />
    <link rel="apple-touch-icon" sizes="180x180" href="/favicons/apple-icon-180x180.png" />
    <link rel="icon" type="image/png" sizes="192x192" href="/favicons/android-icon-192x192.png" />
    <link rel="icon" type="image/png" sizes="32x32" href="/favicons/favicon-32x32.png" />
    <link rel="icon" type="image/png" sizes="96x96" href="/favicons/favicon-96x96.png" />
    <link rel="icon" type="image/png" sizes="16x16" href="/favicons/favicon-16x16.png" />
    <link rel="manifest" href="/favicons/manifest.json" />
    <meta name="msapplication-TileColor" content="#ffffff" />
    <meta name="msapplication-TileImage" content="/favicons/ms-icon-144x144.png" />
    <meta name="theme-color" content="#0b0b0b" />
    <link rel="icon" type="image/x-icon" href="/favicons/favicon.ico" />

    <!-- Preload critical font -->
    <link
      rel="preload"
      href="/fonts/Raleway.ttf"
      as="font"
      type="font/ttf"
      crossorigin="anonymous"
    />

    <!-- Preload critical images for LCP optimization -->
    <link rel="preload" as="image" href="/images/GenesLogo-white.webp" fetchpriority="high" />
    <link rel="preload" as="image" href="/images/novosadski-sajam.webp" fetchpriority="high" />
    <link rel="preload" as="image" href="/images/serbia.webp" fetchpriority="high" />
    <link rel="preload" as="image" href="/images/english.webp" fetchpriority="high" />

    <!-- SEO Tags -->
    <link rel="canonical" href={currentCanonicalURL} />
    <link rel="alternate" hreflang="sr" href={srURL} />
    {enURL && <link rel="alternate" hreflang="en" href={enURL} />}
    <link rel="alternate" hreflang="x-default" href={srURL} />

    <meta property="og:url" content={currentCanonicalURL} />
    <meta property="og:image" content={ogImageURL} />
    <meta property="og:image:type" content="image/webp" />
    <meta property="og:image:width" content="1920" />
    <meta property="og:image:height" content="1080" />
    <meta property="og:image:alt" content={title} />
    <meta property="og:type" content="website" />
    <meta property="og:title" content={title} />
    <meta property="og:description" content={finalDescription} />
    <meta property="og:site_name" content={lang === 'sr' ? 'Menjačnica Genes' : 'Genes Exchange'} />
    <meta property="og:locale" content={lang === 'sr' ? 'sr_RS' : 'en_US'} />

    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content={title} />
    <meta name="twitter:description" content={finalDescription} />
    <meta name="twitter:image" content={ogImageURL} />
    <meta name="twitter:image:alt" content={title} />

    <!-- Author -->
    <meta name="author" content={lang === 'sr' ? 'Menjačnica Genes' : 'Genes Exchange'} />

    <!-- Structured Data -->
    <script type="application/ld+json" set:html={JSON.stringify(organizationSchema)} />
    <script type="application/ld+json" set:html={JSON.stringify(websiteSchema)} />

    <title>{title}</title>

    <!-- Additional head content -->
    <slot name="head" />

    <!-- Google Analytics -->
    <script is:inline>
      window.addEventListener('load', function () {
        setTimeout(function () {
          var script = document.createElement('script');
          script.async = true;
          script.src = 'https://www.googletagmanager.com/gtag/js?id=G-9N2QRN6XCT';
          document.head.appendChild(script);

          window.dataLayer = window.dataLayer || [];
          function gtag() {
            dataLayer.push(arguments);
          }
          gtag('js', new Date());
          gtag('config', 'G-9N2QRN6XCT');
        }, 1000);
      });
    </script>
  </head>
  <body class={isErrorPage ? 'error-page-body' : ''}>
    <Header lang={lang} />

    <slot />

    <Footer lang={lang} />

    <script>
      import '../main.ts';
    </script>
  </body>
</html>
